ggplot(.,aes(x=reorder(neighbourhood,-median_rent_max),y=median_rent_max,fill=number))+
geom_col()+
coord_flip()+
theme(axis.text.x = element_text(angle=90,hjust=1)) +
ggtitle("Neighbourhood by Median Rent")
# Median commute by neighbourhood
output_neighbourhood %>%
ggplot(.,aes(x=reorder(neighbourhood,-median_commute_time),y=median_commute_time,fill=number))+
geom_col()+
coord_flip()+
theme(axis.text.x = element_text(angle=90,hjust=1)) +
ggtitle("Neighbourhood by Median Commute")
# Cost vs Commute by neighbourhood
output_neighbourhood %>%
ggplot(.,aes(median_rent_max,median_commute_time))+
geom_point(aes(size=number)) +
geom_smooth() +
CustomTheme +
geom_label_repel(data=filter(.,med_commute_time <=25),label = neighbourhood)
# Cost vs Commute by neighbourhood
output_neighbourhood %>%
ggplot(.,aes(median_rent_max,median_commute_time))+
geom_point(aes(size=number)) +
geom_smooth() +
CustomTheme +
geom_label_repel(data=filter(output_neighbourhood,med_commute_time <=25),label = neighbourhood)
output_neighbourhood
# Cost vs Commute by neighbourhood
output_neighbourhood %>%
ggplot(.,aes(median_rent_max,median_commute_time))+
geom_point(aes(size=number)) +
geom_smooth() +
CustomTheme +
geom_label_repel(data=filter(output_neighbourhood,med_commute_time <=25),label = neighbourhood)
# Cost vs Commute by neighbourhood
output_neighbourhood %>%
ggplot(.,aes(median_rent_max,median_commute_time))+
geom_point(aes(size=number)) +
geom_smooth() +
CustomTheme +
geom_label_repel(data=filter(output_neighbourhood,med_commute_time <=25,label = neighbourhood))
# Cost vs Commute by neighbourhood
output_neighbourhood %>%
ggplot(.,aes(median_rent_max,median_commute_time))+
geom_point(aes(size=number)) +
geom_smooth() +
CustomTheme +
geom_label_repel(data=filter(output_neighbourhood,med_commute_time <=25),label = neighbourhood)
filter(output_neighbourhood,med_commute_time <=25)
# Cost vs Commute by neighbourhood
output_neighbourhood %>%
ggplot(.,aes(median_rent_max,median_commute_time))+
geom_point(aes(size=number)) +
geom_smooth() +
CustomTheme +
geom_label_repel(data=filter(output_neighbourhood,median_commute_time <=25),label = neighbourhood)
filter(output_neighbourhood,median_commute_time <=25)
# Cost vs Commute by neighbourhood
output_neighbourhood %>%
ggplot(.,aes(median_rent_max,median_commute_time))+
geom_point(aes(size=number)) +
geom_smooth() +
CustomTheme +
geom_label_repel(data=subset(output_neighbourhood,median_commute_time <=25),label = neighbourhood)
subset(output_neighbourhood,median_commute_time <=25)
# Cost vs Commute by neighbourhood
output_neighbourhood %>%
ggplot(.,aes(median_rent_max,median_commute_time))+
geom_point(aes(size=number)) +
geom_smooth() +
CustomTheme +
geom_label_repel(data=subset(output_neighbourhood,median_commute_time <=25),aes(label = neighbourhood))
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))
output_out
# Assinging points by distance and cost
output_analysis <- output_out %>%
mutate(price_2 = monthly_max_usd ** 2,
time_2 = commute_time ** 2)
# Assinging points by distance and cost
output_analysis <- output_out %>%
mutate(price_2 = (monthly_max_usd ** 2) / median(monthly_price_usd ** 2),
time_2 = commute_time ** 2 / median(commute_time ** 2),
timeprice_2 = price_2 * time_2)
# Assinging points by distance and cost
output_analysis <- output_out %>%
mutate(price_2 = (monthly_max_usd ** 2) / median(monthly_max_usd ** 2),
time_2 = commute_time ** 2 / median(commute_time ** 2),
timeprice_2 = price_2 * time_2)
output_analysis
View(output_analysis)
# Assinging points by distance and cost
output_analysis <- output_out %>%
mutate(price_2 = (monthly_max_usd ** 2) / median(monthly_max_usd ** 2, na.rm==TRUE),
time_2 = commute_time ** 2 / median(commute_time ** 2, na.rm==TRUE),
timeprice_2 = price_2 * time_2)
?median
# Assinging points by distance and cost
output_analysis <- output_out %>%
mutate(price_2 = (monthly_max_usd ** 2) / median(monthly_max_usd ** 2, na.rm=TRUE),
time_2 = commute_time ** 2 / median(commute_time ** 2, na.rm=TRUE),
timeprice_2 = price_2 * time_2)
source('~/R/Side Projects/Rent Scraping/rent_analysis.R', echo=TRUE)
?GeomAnnotationMap
summary_postcode
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_text(data=summary_postcode,aes(long,lat,label = medina_monthly))
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_text(data=summary_postcode,aes(long,lat,label = median_monthly))
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
#geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_text(data=summary_postcode,aes(long,lat,label = median_monthly))
geom_text(data=summary_postcode,aes(long,lat,label = ceiling(median_monthly))
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
#geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_text(data=summary_postcode,aes(long,lat,label = ceiling(median_monthly)))
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
#geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_text(data=summary_postcode,aes(long,lat,label = ceiling(median_monthly)))
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
#geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_text(data=summary_postcode,aes(long,lat,label = ceiling(median_monthly),size=11))
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
#geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_text(data=summary_postcode,aes(long,lat,label = ceiling(median_monthly),size=8))
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
#geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_text(data=summary_postcode,aes(long,lat,label = ceiling(median_monthly),size=5))
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
#geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_text(data=summary_postcode,aes(long,lat,label = ceiling(median_monthly)),size=5)
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
#geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_text(data=summary_postcode,aes(long,lat,label = ceiling(median_monthly)),size=2)
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
#geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_text(data=summary_postcode,aes(long,lat,label = ceiling(median_monthly)),size=4)
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
#geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_text(data=summary_postcode,aes(long,lat,label = ceiling(median_monthly)),size=4,colour="black") +
geom_text(data=summary_postcode,aes(long,lat,label = ceiling(median_monthly)),size=5,colour="white")
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
#geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_text(data=summary_postcode,aes(long,lat,label = ceiling(median_monthly)),size=4.2,colour="white") +
geom_text(data=summary_postcode,aes(long,lat,label = ceiling(median_monthly)),size=4,colour="black") +
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
#geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_text(data=summary_postcode,aes(long,lat,label = ceiling(median_monthly)),size=4.2,colour="white") +
geom_text(data=summary_postcode,aes(long,lat,label = ceiling(median_monthly)),size=4,colour="black")
install.packages("shadowtext")
library(shadowtext)
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
#geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_shadowtext(data=summary_postcode,aes(long,lat,label = ceiling(median_monthly)),size=4)
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
#geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_shadowtext(data=summary_postcode,aes(long,lat,label = ceiling(median_monthly)),size=3)
?geom_shadowtext
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
#geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_shadowtext(data=summary_postcode,aes(long,lat,label = ceiling(median_monthly)),size=3, colour = "black", bg.colour = "white")
summary_postcode
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
#geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_shadowtext(data=summary_postcode,aes(long,lat,label = ceiling(max_monthly)),size=3, colour = "black", bg.colour = "white")
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
#geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_shadowtext(data=summary_postcode,aes(long,lat,label = ceiling(min_monthly)),size=3, colour = "black", bg.colour = "white")
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
#geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_shadowtext(data=summary_postcode,aes(long,lat,label = ceiling(med_commute_time)),size=3, colour = "black", bg.colour = "white")
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
#geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_shadowtext(data=summary_postcode,aes(long,lat,label = ceiling(num)),size=3, colour = "black", bg.colour = "white")
ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
#geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_shadowtext(data=summary_postcode,aes(long,lat,label = ceiling(median_monthly)),size=3, colour = "black", bg.colour = "white")
rent_map <- ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
#geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_shadowtext(data=summary_postcode,aes(long,lat,label = ceiling(median_monthly)),size=3, colour = "black", bg.colour = "white")
source('~/R/Side Projects/Rent Scraping/rent_analysis.R', echo=TRUE)
# Neighbourhoods Data
r <- GET('http://data.beta.nyc//dataset/0ff93d2d-90ba-457c-9f7e-39e47bf2ac5f/resource/35dd04fb-81b3-479b-a074-a27a37888ce7/download/d085e2f8d0b54d4590b1e7d1f35594c1pediacitiesnycneighborhoods.geojson')
nyc_neighborhoods <- readOGR(content(r,'text'), 'OGRGeoJSON', verbose = F)
summary(nyc_neighborhoods)
nyc_neighborhoods_df <- tidy(nyc_neighborhoods)
rent_map <- ggmap(nyc_map) +
geom_polygon(data=plot_data, aes(x=long_zip, y=lat_zip, group=group, fill = med_commute_time),colour="blue",alpha=0.7) +
scale_fill_gradient2(low="green",high="red",mid="white",midpoint = 25,limits=c(0,45))+
#geom_point(data=summary_postcode,aes(long,lat,size=median_monthly),alpha = 0.5)+
xlim(c(-74.05,-73.9))+
ylim(c(40.63,40.85))+
geom_shadowtext(data=summary_postcode,aes(long,lat,label = ceiling(median_monthly)),size=3, colour = "black", bg.colour = "white")
rent_map
set.seed(142)
png("2019 07 16 Rent map.png", width=1280,height=800,res=144)
rent_map
dev.off()
set.seed(142)
png("2019 07 16 Rent map.png", width=900,height=1800,res=144)
rent_map
dev.off()
set.seed(142)
png("2019 07 16 Rent map.png", width=900,height=1600,res=144)
rent_map
dev.off()
set.seed(142)
png("2019 07 16 Rent map.png", width=900,height=1400,res=144)
rent_map
dev.off()
load("~/GitHub/rent-scraping/scrapes/2019-7-12 rent_scrape.Rdata")
library(rvest)
library(tidyverse)
library(gsubfn)
library(lubridate)
library(googleAuthR)
library(gmapsdistance)
library(tigris)
# Inputs ------------------------------------------------------------------
google_login <- read_lines("C:/Users/charlie-kershaw/Documents/R/google_api_key.txt")
# Create a search on spare room and copy the search id for the search here (this allows you to set preferences like max rent, smoking/non-smoking etc)
search_id <- "search_id=500028946123" # Search for NYC, no smoking, max $2000 a month
# Page URL Examples:
#   Page 0: "https://www.spareroom.com/roommate/?offset=0&search_id=500028946123&sort_by=age&mode=list"
#   Page 2: "https://www.spareroom.com/roommate/?offset=10&search_id=500028946123&sort_by=age&mode=list"
#   Page 3: "https://www.spareroom.com/roommate/?offset=20&search_id=500028946123&sort_by=age&mode=list"
results_per_page <- 11
# Logging into google -----------------------------------------------------
register_google(key = google_login)
# Inputs ------------------------------------------------------------------
google_login <- read_lines("C:/Users/charlie-kershaw/Documents/R/google_api_key.txt")
# Logging into google -----------------------------------------------------
register_google(key = google_login)
library(googleAuthR)
library(ggmaps)
library(ggmap)
# Logging into google -----------------------------------------------------
register_google(key = google_login)
# Pulling commute time ----------------------------------------------------
set.api.key(google_login)
f_timedistance <- function(latlong){
output = gmapsdistance(origin = latlong,
destination = office,
key = get.api.key(),
mode = "transit",
arr_date = "2019-09-02",
arr_time = "08:30:00")
}
# Example commute time pull start
home = c("40.431478+-80.0505401","40.8310224+-73.9095279","40.7043156+-73.9212858")
office = c("40.756950+-73.982033")
test_input <- tibble(latlong=home)
test_times <- f_timedistance(test$latlong)
f_timedistance <- function(latlong){
output = gmapsdistance(origin = latlong,
destination = office,
key = get.api.key(),
mode = "transit",
arr_date = "2020-06-02",
arr_time = "08:30:00")
}
# Example commute time pull start
home = c("40.431478+-80.0505401","40.8310224+-73.9095279","40.7043156+-73.9212858")
office = c("40.756950+-73.982033")
test_input <- tibble(latlong=home)
test_times <- f_timedistance(test$latlong)
test_output <- test_input %>%
mutate(distance = unlist(x$Distance[2]),time = unlist(x$Time[2]))
test_output
test_times <- f_timedistance(test_input$latlong)
test_output <- test_input %>%
mutate(distance = unlist(x$Distance[2]),time = unlist(x$Time[2]))
test_output
test_input <- tibble(latlong=home)
test_times <- f_timedistance(test_input$latlong)
test_output <- test_input %>%
mutate(distance = unlist(x$Distance[2]),time = unlist(x$Time[2]))
test_output <- test_input %>%
mutate(distance = unlist(test_times$Distance[2]),time = unlist(test_times$Time[2]))
test_output
#create custom theme---------------------------------------------
CustomTheme <- theme_bw()+
theme(
legend.text = element_text(colour="grey47"),
legend.title = element_text(colour="grey47", face = "bold"),
legend.background = element_rect(colour="grey", fill = "grey94"),
panel.background = element_rect("white"),
plot.background = element_rect("white"),
panel.border = element_rect("grey",fill=NA),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
plot.title = element_text(hjust=0.5,colour="#2F8197", face = "bold", size = 14),
plot.subtitle = element_text(colour="grey47"),
axis.title = element_text(colour="grey47", face = "bold"),
axis.text = element_text(colour="grey47"),
strip.background = element_rect(colour="grey70",fill="lightblue1"),
strip.text = element_text(colour="grey47", face = "bold")
)
library(tidyverse)
#create custom theme---------------------------------------------
CustomTheme <- theme_bw()+
theme(
legend.text = element_text(colour="grey47"),
legend.title = element_text(colour="grey47", face = "bold"),
legend.background = element_rect(colour="grey", fill = "grey94"),
panel.background = element_rect("white"),
plot.background = element_rect("white"),
panel.border = element_rect("grey",fill=NA),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
plot.title = element_text(hjust=0.5,colour="#2F8197", face = "bold", size = 14),
plot.subtitle = element_text(colour="grey47"),
axis.title = element_text(colour="grey47", face = "bold"),
axis.text = element_text(colour="grey47"),
strip.background = element_rect(colour="grey70",fill="lightblue1"),
strip.text = element_text(colour="grey47", face = "bold")
)
load("scrapes/2019-7-12 rent_scrape.Rdata")
# Cutting out too far
output_out <- output_commute %>%
mutate(commute_time = commute_time / 60) %>%
filter(commute_time <= 45)
# Assinging points by distance and cost
output_analysis <- output_out %>%
mutate(price_2 = (monthly_max_usd ** 2) / median(monthly_max_usd ** 2, na.rm=TRUE),
time_2 = commute_time ** 2 / median(commute_time ** 2, na.rm=TRUE),
timeprice_2 = price_2 * time_2)
# Grouped by neighbourhood
output_neighbourhood <- output_out %>%
group_by(neighbourhood) %>%
summarise(median_commute_time = median(commute_time,na.rm = TRUE),median_rent_max = median(monthly_max_usd,na.rm = TRUE),number=n())
# Median cost by neighbourhood
output_neighbourhood %>%
ggplot(.,aes(x=reorder(neighbourhood,-median_rent_max),y=median_rent_max,fill=number))+
geom_col()+
coord_flip()+
theme(axis.text.x = element_text(angle=90,hjust=1)) +
ggtitle("Neighbourhood by Median Rent")
# Median commute by neighbourhood
output_neighbourhood %>%
ggplot(.,aes(x=reorder(neighbourhood,-median_commute_time),y=median_commute_time,fill=number))+
geom_col()+
coord_flip()+
theme(axis.text.x = element_text(angle=90,hjust=1)) +
ggtitle("Neighbourhood by Median Commute")
# Cost vs Commute by neighbourhood
output_neighbourhood %>%
ggplot(.,aes(median_rent_max,median_commute_time))+
geom_point(aes(size=number)) +
geom_smooth() +
CustomTheme +
geom_label_repel(data=subset(output_neighbourhood,median_commute_time <=25),aes(label = neighbourhood))
library(ggrepel)
# Cost vs Commute by neighbourhood
output_neighbourhood %>%
ggplot(.,aes(median_rent_max,median_commute_time))+
geom_point(aes(size=number)) +
geom_smooth() +
CustomTheme +
geom_label_repel(data=subset(output_neighbourhood,median_commute_time <=25),aes(label = neighbourhood))
# Summary info by postcode
summary_postcode <- output_out %>%
mutate(long_lat = paste0(long,"-",lat)) %>%
group_by(long_lat) %>%
summarise(long=max(long),
lat=max(lat),
postcode=max(postcode),
median_monthly = median(monthly_max_usd,na.rm=TRUE),
min_monthly = min(monthly_min_usd,na.rm=TRUE),
max_monthly = max(monthly_max_usd,na.rm=TRUE),
med_commute_time = median(commute_time),
med_commute_distance = median(commute_distance),
num = n())
# Setting up map ----------------------------------------------------------
nyc_map <- get_map(location = c(lon = -74.00, lat = 40.71), maptype = "terrain", zoom = 11)
library(ggmap)
# Setting up map ----------------------------------------------------------
nyc_map <- get_map(location = c(lon = -74.00, lat = 40.71), maptype = "terrain", zoom = 11)
library(rvest)
library(tidyverse)
library(gsubfn)
library(lubridate)
library(googleAuthR)
library(gmapsdistance)
library(tigris)
# Inputs ------------------------------------------------------------------
google_login <- read_lines("C:/Users/charlie-kershaw/Documents/R/google_api_key.txt")
# Create a search on spare room and copy the search id for the search here (this allows you to set preferences like max rent, smoking/non-smoking etc)
Logging into google -----------------------------------------------------
register_google(key = google_login)
library(ggmap)
# Logging into google -----------------------------------------------------
register_google(key = google_login)
# Pulling commute time ----------------------------------------------------
set.api.key(google_login)
f_timedistance <- function(latlong){
output = gmapsdistance(origin = latlong,
destination = office,
key = get.api.key(),
mode = "transit",
arr_date = "2020-06-01",
arr_time = "08:30:00")
}
# Example commute time pull start
home = c("40.431478+-80.0505401","40.8310224+-73.9095279","40.7043156+-73.9212858")
office = c("40.756950+-73.982033")
test_input <- tibble(latlong=home)
test_times <- f_timedistance(test$latlong)
test_output <- test_input %>%
mutate(distance = unlist(test_times$Distance[2]),time = unlist(test_times$Time[2]))
test_times <- f_timedistance(test_input$latlong)
test_output <- test_input %>%
mutate(distance = unlist(test_times$Distance[2]),time = unlist(test_times$Time[2]))
test_output
